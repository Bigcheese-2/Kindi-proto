# Story 2.2: Timeline Component

## Status
Draft

## Story
**As an** analyst,
**I want** to see events on a chronological timeline,
**so that** I can understand the sequence and timing of events.

## Acceptance Criteria
1: vis-timeline is integrated into the application
2: Events are displayed on the timeline with appropriate styling
3: Events are grouped by type or category
4: Timeline supports zooming to different time scales
5: Timeline displays event details on hover
6: Timeline supports selecting time ranges

## Tasks / Subtasks
- [ ] Set up vis-timeline integration (AC: 1)
  - [ ] Install vis-timeline and dependencies
  - [ ] Create TimelineComponent wrapper for vis-timeline
  - [ ] Configure basic timeline settings and properties
  - [ ] Implement timeline container with appropriate dimensions

- [ ] Implement event visualization (AC: 2)
  - [ ] Create event item rendering with event data
  - [ ] Implement styling based on event type
  - [ ] Add visual indicators for event duration
  - [ ] Create custom event templates for different event types

- [ ] Implement event grouping (AC: 3)
  - [ ] Create group definitions based on event types
  - [ ] Implement group styling and headers
  - [ ] Add collapsible/expandable groups
  - [ ] Create group filtering controls

- [ ] Implement timeline navigation (AC: 4)
  - [ ] Add zoom in/out controls
  - [ ] Implement time range navigation
  - [ ] Add buttons for common time periods (day, week, month, year)
  - [ ] Implement keyboard shortcuts for navigation

- [ ] Implement event details display (AC: 5)
  - [ ] Create hover tooltips with event information
  - [ ] Style tooltips based on event type
  - [ ] Include relevant event metadata in tooltips
  - [ ] Add links to related entities in tooltips

- [ ] Implement time range selection (AC: 6)
  - [ ] Add range selection functionality
  - [ ] Create visual indicator for selected range
  - [ ] Implement callbacks for range selection events
  - [ ] Add controls to clear or modify selection

## Dev Notes

### Visualization Component Structure
[Source: architecture/technical-architecture-document.md#component-architecture]

The Timeline Component should be implemented in the visualization components directory:

```
app/
└── components/
    └── visualizations/
        └── timeline/
            ├── TimelineComponent.tsx    # Main timeline component
            ├── TimelineControls.tsx     # Zoom, navigation controls
            ├── EventItem.tsx            # Custom event rendering
            ├── EventTooltip.tsx         # Hover tooltip component
            └── TimelineGroups.tsx       # Group definition and styling
```

### Data Transformation
[Source: architecture/technical-architecture-document.md#data-transformation-indexing]

Transform the event data into the format required by vis-timeline:

```typescript
// Transform events to timeline items
const transformEventsToTimelineItems = (events: Event[]): TimelineItem[] => {
  return events.map(event => ({
    id: event.id,
    content: event.title,
    title: event.description || event.title, // For tooltip
    start: new Date(event.time),
    end: event.endTime ? new Date(event.endTime) : undefined,
    group: event.type,
    className: `event-type-${event.type}`,
    itemProps: {
      entities: event.entities,
      location: event.location,
      attributes: event.attributes
    }
  }));
};

// Create timeline groups
const createTimelineGroups = (eventTypes: EventType[]): TimelineGroup[] => {
  return eventTypes.map((type, index) => ({
    id: type,
    content: getEventTypeLabel(type),
    className: `group-type-${type}`
  }));
};
```

### vis-timeline Configuration
[Source: architecture/technical-architecture-document.md#visualization-libraries]

The vis-timeline library should be configured with the following options:

```typescript
const options = {
  height: '100%',
  stack: true,
  showCurrentTime: true,
  zoomable: true,
  selectable: true,
  editable: false,
  margin: {
    item: 10,
    axis: 5
  },
  orientation: 'top',
  groupOrder: 'content',
  tooltip: {
    followMouse: true,
    overflowMethod: 'cap'
  }
};

<Timeline
  options={options}
  items={timelineItems}
  groups={timelineGroups}
  onSelect={handleItemSelect}
  onRangeChange={handleRangeChange}
/>
```

### Event Styling
Create a styling system for different event types:

```css
/* Example styling for different event types */
.event-type-meeting {
  background-color: #4285F4;
  border-color: #2A56C6;
  color: white;
}

.event-type-communication {
  background-color: #34A853;
  border-color: #1E7E34;
  color: white;
}

.event-type-transaction {
  background-color: #FBBC05;
  border-color: #F5A623;
  color: black;
}

.event-type-travel {
  background-color: #EA4335;
  border-color: #C5221F;
  color: white;
}

.event-type-incident {
  background-color: #9C27B0;
  border-color: #7B1FA2;
  color: white;
}
```

### Selection Integration
[Source: architecture/technical-architecture-document.md#synchronization-architecture]

The timeline component should integrate with the SelectionContext:

```typescript
const { selectedEventIds, selectedEntityIds, selectEvent } = useContext(SelectionContext);

// Handle event selection
const handleItemSelect = useCallback(({ items }) => {
  if (items.length > 0) {
    selectEvent(items[0]);
  }
}, [selectEvent]);

// Filter timeline based on selected entities
useEffect(() => {
  if (selectedEntityIds.length > 0) {
    const filteredItems = timelineItems.filter(item => 
      item.itemProps.entities.some(id => selectedEntityIds.includes(id))
    );
    setVisibleItems(filteredItems);
  } else {
    setVisibleItems(timelineItems);
  }
}, [selectedEntityIds, timelineItems]);
```

### Testing

#### Testing Strategy
[Source: architecture/technical-architecture-document.md#testing-strategy]

For this story, focus on:

1. **Component Testing**: Test the timeline component rendering and interactions
2. **Date Handling**: Test with various date formats and time ranges
3. **Integration Testing**: Test integration with the data context and selection context

Test files should be organized in the `tests` directory with appropriate subdirectories for unit and integration tests.

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2023-06-18 | 0.1 | Initial story draft | Scrum Master |

## Dev Agent Record

### Agent Model Used

### Debug Log References

### Completion Notes List

### File List

## QA Results
