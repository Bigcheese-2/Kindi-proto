# Story 2.2: Timeline Component

## Status

Done

## Story

**As an** analyst,
**I want** to see events on a chronological timeline,
**so that** I can understand the sequence and timing of events.

## Acceptance Criteria

1: vis-timeline is integrated into the application
2: Events are displayed on the timeline with appropriate styling
3: Events are grouped by type or category
4: Timeline supports zooming to different time scales
5: Timeline displays event details on hover
6: Timeline supports selecting time ranges

## Tasks / Subtasks

- [x] Set up vis-timeline integration (AC: 1)
  - [x] Install vis-timeline and dependencies
  - [x] Create TimelineComponent wrapper for vis-timeline
  - [x] Configure basic timeline settings and properties
  - [x] Implement timeline container with appropriate dimensions

- [x] Implement event visualization (AC: 2)
  - [x] Create event item rendering with event data
  - [x] Implement styling based on event type
  - [x] Add visual indicators for event duration
  - [x] Create custom event templates for different event types

- [x] Implement event grouping (AC: 3)
  - [x] Create group definitions based on event types
  - [x] Implement group styling and headers
  - [x] Add collapsible/expandable groups
  - [x] Create group filtering controls

- [x] Implement timeline navigation (AC: 4)
  - [x] Add zoom in/out controls
  - [x] Implement time range navigation
  - [x] Add buttons for common time periods (day, week, month, year)
  - [x] Implement keyboard shortcuts for navigation

- [x] Implement event details display (AC: 5)
  - [x] Create hover tooltips with event information
  - [x] Style tooltips based on event type
  - [x] Include relevant event metadata in tooltips
  - [x] Add links to related entities in tooltips

- [x] Implement time range selection (AC: 6)
  - [x] Add range selection functionality
  - [x] Create visual indicator for selected range
  - [x] Implement callbacks for range selection events
  - [x] Add controls to clear or modify selection

## Dev Notes

### Visualization Component Structure

[Source: architecture/technical-architecture-document.md#component-architecture]

The Timeline Component should be implemented in the visualization components directory:

```
app/
└── components/
    └── visualizations/
        └── timeline/
            ├── TimelineComponent.tsx    # Main timeline component
            ├── TimelineControls.tsx     # Zoom, navigation controls
            ├── EventItem.tsx            # Custom event rendering
            ├── EventTooltip.tsx         # Hover tooltip component
            └── TimelineGroups.tsx       # Group definition and styling
```

### Data Transformation

[Source: architecture/technical-architecture-document.md#data-transformation-indexing]

Transform the event data into the format required by vis-timeline:

```typescript
// Transform events to timeline items
const transformEventsToTimelineItems = (events: Event[]): TimelineItem[] => {
  return events.map(event => ({
    id: event.id,
    content: event.title,
    title: event.description || event.title, // For tooltip
    start: new Date(event.time),
    end: event.endTime ? new Date(event.endTime) : undefined,
    group: event.type,
    className: `event-type-${event.type}`,
    itemProps: {
      entities: event.entities,
      location: event.location,
      attributes: event.attributes,
    },
  }));
};

// Create timeline groups
const createTimelineGroups = (eventTypes: EventType[]): TimelineGroup[] => {
  return eventTypes.map((type, index) => ({
    id: type,
    content: getEventTypeLabel(type),
    className: `group-type-${type}`,
  }));
};
```

### vis-timeline Configuration

[Source: architecture/technical-architecture-document.md#visualization-libraries]

The vis-timeline library should be configured with the following options:

```typescript
const options = {
  height: '100%',
  stack: true,
  showCurrentTime: true,
  zoomable: true,
  selectable: true,
  editable: false,
  margin: {
    item: 10,
    axis: 5
  },
  orientation: 'top',
  groupOrder: 'content',
  tooltip: {
    followMouse: true,
    overflowMethod: 'cap'
  }
};

<Timeline
  options={options}
  items={timelineItems}
  groups={timelineGroups}
  onSelect={handleItemSelect}
  onRangeChange={handleRangeChange}
/>
```

### Event Styling

Create a styling system for different event types:

```css
/* Example styling for different event types */
.event-type-meeting {
  background-color: #4285f4;
  border-color: #2a56c6;
  color: white;
}

.event-type-communication {
  background-color: #34a853;
  border-color: #1e7e34;
  color: white;
}

.event-type-transaction {
  background-color: #fbbc05;
  border-color: #f5a623;
  color: black;
}

.event-type-travel {
  background-color: #ea4335;
  border-color: #c5221f;
  color: white;
}

.event-type-incident {
  background-color: #9c27b0;
  border-color: #7b1fa2;
  color: white;
}
```

### Selection Integration

[Source: architecture/technical-architecture-document.md#synchronization-architecture]

The timeline component should integrate with the SelectionContext:

```typescript
const { selectedEventIds, selectedEntityIds, selectEvent } = useContext(SelectionContext);

// Handle event selection
const handleItemSelect = useCallback(
  ({ items }) => {
    if (items.length > 0) {
      selectEvent(items[0]);
    }
  },
  [selectEvent]
);

// Filter timeline based on selected entities
useEffect(() => {
  if (selectedEntityIds.length > 0) {
    const filteredItems = timelineItems.filter(item =>
      item.itemProps.entities.some(id => selectedEntityIds.includes(id))
    );
    setVisibleItems(filteredItems);
  } else {
    setVisibleItems(timelineItems);
  }
}, [selectedEntityIds, timelineItems]);
```

### Testing

#### Testing Strategy

[Source: architecture/technical-architecture-document.md#testing-strategy]

For this story, focus on:

1. **Component Testing**: Test the timeline component rendering and interactions
2. **Date Handling**: Test with various date formats and time ranges
3. **Integration Testing**: Test integration with the data context and selection context

Test files should be organized in the `tests` directory with appropriate subdirectories for unit and integration tests.

## Change Log

| Date       | Version | Description         | Author       |
| ---------- | ------- | ------------------- | ------------ |
| 2023-06-18 | 0.1     | Initial story draft | Scrum Master |

## Dev Agent Record

### Agent Model Used

Claude Sonnet 4

### Debug Log References

No major debug issues encountered. vis-timeline integration handled with proper styling.

### Completion Notes List

- ✅ Successfully integrated vis-timeline for chronological event visualization
- ✅ Implemented event transformation and grouping by event type
- ✅ Added comprehensive timeline controls for navigation and zoom
- ✅ Created custom styling for event types with color coding
- ✅ Implemented event selection and interaction functionality
- ✅ Added time period controls (day, week, month, year)
- ✅ Integrated with DataContext and SelectionContext

### File List

- app/components/visualizations/timeline/TimelineComponent.tsx
- app/components/visualizations/timeline/TimelineControls.tsx
- app/components/visualizations/TimelinePanel.tsx (updated)

## QA Results
