# Story 1.3: Sample Data Loading

## Status
Draft

## Story
**As an** analyst,
**I want** to load sample datasets into the application,
**so that** I can start working with visualizations.

## Acceptance Criteria
1: Sample JSON data structure is defined for entities, relationships, events, and locations
2: At least one sample dataset is created following the defined structure
3: Data loading mechanism is implemented
4: Data selection interface allows choosing from available datasets
5: Loading state indicators show when data is being processed
6: Error handling for malformed data is implemented

## Tasks / Subtasks
- [x] Define data models and structures (AC: 1)
  - [x] Create TypeScript interfaces for Entity, Relationship, Event, and GeoLocation
  - [x] Define enums for entity types, relationship types, event types, and location types
  - [x] Create Dataset interface to combine all data elements
  - [x] Document data model structure and relationships

- [x] Create sample datasets (AC: 2)
  - [x] Create a default sample dataset with realistic intelligence analysis data
  - [x] Include various entity types, relationships, events, and locations
  - [x] Ensure data has meaningful connections for demonstration purposes
  - [x] Create at least one additional dataset for comparison

- [x] Implement data loading mechanism (AC: 3)
  - [x] Create data service for loading static JSON files
  - [x] Implement dataset loading functions
  - [x] Add data transformation utilities for visualization components
  - [x] Create data context provider for application-wide data access

- [x] Create dataset selection interface (AC: 4)
  - [x] Implement dataset selection component
  - [x] Add dataset information display (name, description, size)
  - [x] Create dataset switching functionality
  - [x] Persist selected dataset preference

- [x] Implement loading states (AC: 5)
  - [x] Add loading indicators for data loading operations
  - [x] Create loading overlay for initial data load
  - [x] Implement progress indicators for large datasets
  - [x] Add transition animations between dataset changes

- [x] Implement error handling (AC: 6)
  - [x] Add validation for dataset structure and content
  - [x] Create error display components for data loading failures
  - [x] Implement fallback to default dataset on error
  - [x] Add detailed error logging for debugging

## Dev Notes

### Data Models
[Source: architecture/technical-architecture-document.md#data-models]

The data models should follow these TypeScript interfaces:

```typescript
interface Entity {
  id: string;
  type: EntityType;
  name: string;
  attributes: Record<string, any>;
  risk?: number;
  metadata?: Record<string, any>;
}

enum EntityType {
  PERSON = 'person',
  ORGANIZATION = 'organization',
  OBJECT = 'object',
  LOCATION = 'location',
  DIGITAL = 'digital',
  CUSTOM = 'custom'
}

interface Relationship {
  id: string;
  type: RelationshipType;
  source: string; // Entity ID
  target: string; // Entity ID
  directed: boolean;
  strength?: number;
  startTime?: string; // ISO date string
  endTime?: string; // ISO date string
  attributes?: Record<string, any>;
}

enum RelationshipType {
  KNOWS = 'knows',
  OWNS = 'owns',
  LOCATED_AT = 'located_at',
  COMMUNICATES = 'communicates',
  TRAVELS_TO = 'travels_to',
  CUSTOM = 'custom'
}

interface Event {
  id: string;
  type: EventType;
  title: string;
  description?: string;
  time: string; // ISO date string
  endTime?: string; // ISO date string for duration events
  location?: GeoLocation;
  entities: string[]; // Array of Entity IDs
  attributes?: Record<string, any>;
}

enum EventType {
  MEETING = 'meeting',
  COMMUNICATION = 'communication',
  TRANSACTION = 'transaction',
  TRAVEL = 'travel',
  INCIDENT = 'incident',
  CUSTOM = 'custom'
}

interface GeoLocation {
  id: string;
  name?: string;
  latitude: number;
  longitude: number;
  type?: LocationType;
  address?: string;
  attributes?: Record<string, any>;
}

enum LocationType {
  CITY = 'city',
  BUILDING = 'building',
  LANDMARK = 'landmark',
  REGION = 'region',
  CUSTOM = 'custom'
}

interface Dataset {
  id: string;
  name: string;
  description?: string;
  entities: Entity[];
  relationships: Relationship[];
  events: Event[];
  locations: GeoLocation[];
  metadata?: Record<string, any>;
}
```

### Data File Structure
[Source: architecture/technical-architecture-document.md#data-file-structure]

Sample data files should be organized as follows:

```
data/
├── datasets/
│   ├── dataset1.json
│   ├── dataset2.json
│   └── ...
├── schema/
│   ├── entity-schema.json
│   ├── relationship-schema.json
│   ├── event-schema.json
│   └── location-schema.json
└── index.json   # List of available datasets with metadata
```

### Data Service
[Source: architecture/technical-architecture-document.md#api-interface]

Implement a data service following this interface:

```typescript
interface DataService {
  getDatasets(): Promise<DatasetInfo[]>;
  loadDataset(id: string): Promise<Dataset>;
  // Additional methods as needed
}

// Initial implementation using static files
class StaticDataService implements DataService {
  // Implementation using static JSON files
}
```

### Sample Data Structure
[Source: architecture/technical-architecture-document.md#a-sample-data-structure]

Use this sample data structure as a reference:

```json
{
  "id": "operation-blackwater",
  "name": "Operation Blackwater",
  "description": "Intelligence analysis dataset for Operation Blackwater",
  "entities": [
    {
      "id": "e001",
      "type": "person",
      "name": "Viktor Petrov",
      "attributes": {
        "age": 42,
        "nationality": "Russian",
        "occupation": "Businessman"
      },
      "risk": 0.8
    },
    {
      "id": "e002",
      "type": "organization",
      "name": "Global Solutions Ltd",
      "attributes": {
        "industry": "Consulting",
        "founded": "2010-03-15",
        "headquarters": "London"
      }
    }
  ],
  "relationships": [
    {
      "id": "r001",
      "type": "owns",
      "source": "e001",
      "target": "e002",
      "directed": true,
      "strength": 0.9
    }
  ],
  "events": [
    {
      "id": "ev001",
      "type": "meeting",
      "title": "Strategic Planning Meeting",
      "description": "Meeting between key stakeholders",
      "time": "2023-05-10T14:30:00Z",
      "endTime": "2023-05-10T16:00:00Z",
      "entities": ["e001", "e002"],
      "location": {
        "id": "l001",
        "name": "Grand Hotel",
        "latitude": 51.5074,
        "longitude": -0.1278
      }
    }
  ]
}
```

### Dataset Context
[Source: architecture/technical-architecture-document.md#core-state-contexts]

Implement a Dataset Context with this structure:

```typescript
interface DatasetContextType {
  currentDataset: Dataset | null;
  availableDatasets: DatasetInfo[];
  loadDataset: (id: string) => Promise<void>;
  isLoading: boolean;
  error: Error | null;
}
```

### Testing

#### Testing Strategy
[Source: architecture/technical-architecture-document.md#testing-strategy]

For this story, focus on:

1. **Unit Testing**: Test data model validation and transformation functions
2. **Integration Testing**: Test data loading and context integration
3. **Error Handling**: Test error cases with malformed data

Test files should be organized in the `tests` directory with appropriate subdirectories for unit and integration tests.

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2023-06-18 | 0.1 | Initial story draft | Scrum Master |

## Dev Agent Record

### Agent Model Used
Claude 3.7 Sonnet

### Debug Log References
N/A

### Completion Notes List
- Defined TypeScript interfaces for all data models (Entity, Relationship, Event, GeoLocation)
- Created sample datasets with realistic intelligence analysis data
- Implemented data loading mechanism with StaticDataService
- Created DataContext provider for application-wide data access
- Implemented dataset selection interface with information display
- Added loading states and indicators for data loading operations
- Implemented error handling with error display components

### File List
- app/models/data-types.ts (new)
- app/lib/data/DataService.ts (new)
- app/contexts/DataContext.tsx (new)
- app/components/core/DatasetSelector.tsx (new)
- app/components/core/LoadingOverlay.tsx (new)
- app/components/core/ErrorMessage.tsx (new)
- app/components/layout/DashboardContent.tsx (new)
- app/components/layout/ControlPanel.tsx (modified)
- app/components/layout/MainLayout.tsx (modified)
- data/datasets/operation-blackwater.json (new)
- data/datasets/cyber-threat-network.json (new)
- data/index.json (new)

## QA Results
