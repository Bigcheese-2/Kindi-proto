# Story 3.2: Inspector Panel

## Status
Draft

## Story
**As an** analyst,
**I want** to see detailed information about selected items in the Inspector panel,
**so that** I can analyze specific entities, events, or locations.

## Acceptance Criteria
1: Inspector panel shows detailed information about the selected item
2: Panel updates when selection changes in any visualization
3: Panel shows different information types based on selection type (entity, event, location)
4: Panel includes metadata and attributes for the selected item
5: Panel shows related items with links to select them
6: Panel can be collapsed to provide more space for visualizations

## Tasks / Subtasks
- [ ] Create Inspector Panel component (AC: 1, 6)
  - [ ] Implement collapsible sidebar component
  - [ ] Create panel header with title and controls
  - [ ] Add panel content container
  - [ ] Implement collapse/expand animation
  - [ ] Add toggle button for panel visibility

- [ ] Implement selection integration (AC: 2)
  - [ ] Connect Inspector Panel to SelectionContext
  - [ ] Create selection change listeners
  - [ ] Implement panel content updates on selection change
  - [ ] Add loading state for content updates

- [ ] Create type-specific detail views (AC: 3)
  - [ ] Implement EntityDetailView component
  - [ ] Create EventDetailView component
  - [ ] Implement LocationDetailView component
  - [ ] Add type detection and appropriate view selection

- [ ] Implement metadata and attribute display (AC: 4)
  - [ ] Create metadata section component
  - [ ] Implement attribute list component
  - [ ] Add formatting for different attribute types
  - [ ] Create expandable sections for large attribute sets

- [ ] Implement related items section (AC: 5)
  - [ ] Create RelatedItems component
  - [ ] Implement entity relationship visualization
  - [ ] Add related events timeline
  - [ ] Create related locations list
  - [ ] Implement selection links for related items

- [ ] Add panel state management
  - [ ] Connect panel visibility to UIContext
  - [ ] Implement panel size adjustment
  - [ ] Create panel state persistence
  - [ ] Add keyboard shortcuts for panel control

## Dev Notes

### Inspector Panel Structure
[Source: architecture/technical-architecture-document.md#component-architecture]

The Inspector Panel should be implemented as a right sidebar component:

```
app/
└── components/
    └── inspector/
        ├── InspectorPanel.tsx        # Main panel component
        ├── EntityDetailView.tsx      # Entity-specific detail view
        ├── EventDetailView.tsx       # Event-specific detail view
        ├── LocationDetailView.tsx    # Location-specific detail view
        ├── MetadataSection.tsx       # Metadata display component
        ├── AttributeList.tsx         # Attribute list component
        └── RelatedItems.tsx          # Related items component
```

### UI Context Integration
[Source: architecture/technical-architecture-document.md#core-state-contexts]

The Inspector Panel should integrate with the UIContext for visibility control:

```typescript
interface UIContextType {
  // Other UI state properties
  inspectorVisible: boolean; // Right sidebar visibility
  setInspectorVisible: (visible: boolean) => void;
  // Other UI state methods
}

// In the InspectorPanel component
const { inspectorVisible, setInspectorVisible } = useContext(UIContext);

// Toggle panel visibility
const togglePanel = () => {
  setInspectorVisible(!inspectorVisible);
};
```

### Selection Context Integration
[Source: architecture/technical-architecture-document.md#core-state-contexts]

The Inspector Panel should integrate with the SelectionContext to display details for selected items:

```typescript
// In the InspectorPanel component
const {
  selectedEntityIds,
  selectedEventIds,
  selectedLocationIds
} = useContext(SelectionContext);

// Determine what to display based on selection
const getSelectedItem = () => {
  if (selectedEntityIds.length > 0) {
    return {
      type: 'entity',
      id: selectedEntityIds[0]
    };
  }
  
  if (selectedEventIds.length > 0) {
    return {
      type: 'event',
      id: selectedEventIds[0]
    };
  }
  
  if (selectedLocationIds.length > 0) {
    return {
      type: 'location',
      id: selectedLocationIds[0]
    };
  }
  
  return null;
};

// Render appropriate detail view based on selection
const renderDetailView = () => {
  const selectedItem = getSelectedItem();
  
  if (!selectedItem) {
    return <EmptyStateView />;
  }
  
  switch (selectedItem.type) {
    case 'entity':
      return <EntityDetailView entityId={selectedItem.id} />;
    case 'event':
      return <EventDetailView eventId={selectedItem.id} />;
    case 'location':
      return <LocationDetailView locationId={selectedItem.id} />;
    default:
      return <EmptyStateView />;
  }
};
```

### Entity Detail View
The EntityDetailView component should display the following information:

```typescript
interface EntityDetailViewProps {
  entityId: string;
}

const EntityDetailView: React.FC<EntityDetailViewProps> = ({ entityId }) => {
  const { currentDataset } = useContext(DatasetContext);
  const entity = currentDataset?.entities.find(e => e.id === entityId);
  
  if (!entity) {
    return <div>Entity not found</div>;
  }
  
  return (
    <div className="entity-detail-view">
      <h2>{entity.name}</h2>
      <div className="entity-type">
        <TypeBadge type={entity.type} />
      </div>
      
      {entity.risk !== undefined && (
        <div className="risk-indicator">
          <RiskLevel value={entity.risk} />
        </div>
      )}
      
      <MetadataSection metadata={entity.metadata} />
      <AttributeList attributes={entity.attributes} />
      
      <RelatedItems
        entityId={entityId}
        events={currentDataset?.events || []}
        relationships={currentDataset?.relationships || []}
      />
    </div>
  );
};
```

### Event Detail View
The EventDetailView component should display the following information:

```typescript
interface EventDetailViewProps {
  eventId: string;
}

const EventDetailView: React.FC<EventDetailViewProps> = ({ eventId }) => {
  const { currentDataset } = useContext(DatasetContext);
  const event = currentDataset?.events.find(e => e.id === eventId);
  
  if (!event) {
    return <div>Event not found</div>;
  }
  
  // Format date and time
  const formatDate = (dateString: string) => {
    return new Date(dateString).toLocaleString();
  };
  
  return (
    <div className="event-detail-view">
      <h2>{event.title}</h2>
      <div className="event-type">
        <TypeBadge type={event.type} />
      </div>
      
      <div className="event-time">
        <div>Start: {formatDate(event.time)}</div>
        {event.endTime && <div>End: {formatDate(event.endTime)}</div>}
      </div>
      
      {event.description && (
        <div className="event-description">
          <p>{event.description}</p>
        </div>
      )}
      
      {event.location && (
        <div className="event-location">
          <h3>Location</h3>
          <LocationPreview location={event.location} />
        </div>
      )}
      
      <div className="event-entities">
        <h3>Involved Entities</h3>
        <EntityList
          entityIds={event.entities}
          entities={currentDataset?.entities || []}
        />
      </div>
      
      <AttributeList attributes={event.attributes} />
    </div>
  );
};
```

### Location Detail View
The LocationDetailView component should display the following information:

```typescript
interface LocationDetailViewProps {
  locationId: string;
}

const LocationDetailView: React.FC<LocationDetailViewProps> = ({ locationId }) => {
  const { currentDataset } = useContext(DatasetContext);
  const location = currentDataset?.locations.find(l => l.id === locationId);
  
  if (!location) {
    return <div>Location not found</div>;
  }
  
  return (
    <div className="location-detail-view">
      <h2>{location.name || 'Unnamed Location'}</h2>
      
      {location.type && (
        <div className="location-type">
          <TypeBadge type={location.type} />
        </div>
      )}
      
      <div className="location-coordinates">
        <div>Latitude: {location.latitude}</div>
        <div>Longitude: {location.longitude}</div>
      </div>
      
      {location.address && (
        <div className="location-address">
          <h3>Address</h3>
          <p>{location.address}</p>
        </div>
      )}
      
      <div className="location-map">
        <MiniMap
          latitude={location.latitude}
          longitude={location.longitude}
          zoom={13}
        />
      </div>
      
      <RelatedItems
        locationId={locationId}
        events={currentDataset?.events || []}
        entities={currentDataset?.entities || []}
      />
      
      <AttributeList attributes={location.attributes} />
    </div>
  );
};
```

### Related Items Component
The RelatedItems component should display items related to the selected entity, event, or location:

```typescript
interface RelatedItemsProps {
  entityId?: string;
  eventId?: string;
  locationId?: string;
  events: Event[];
  entities: Entity[];
  relationships?: Relationship[];
}

const RelatedItems: React.FC<RelatedItemsProps> = (props) => {
  const { selectEntity, selectEvent, selectLocation } = useContext(SelectionContext);
  
  // Find related items based on props
  const relatedItems = useMemo(() => {
    if (props.entityId) {
      return findRelatedItemsForEntity(
        props.entityId,
        props.events,
        props.relationships || []
      );
    }
    
    if (props.eventId) {
      return findRelatedItemsForEvent(
        props.eventId,
        props.events,
        props.entities
      );
    }
    
    if (props.locationId) {
      return findRelatedItemsForLocation(
        props.locationId,
        props.events,
        props.entities
      );
    }
    
    return { entities: [], events: [], locations: [] };
  }, [props.entityId, props.eventId, props.locationId, props.events, props.entities, props.relationships]);
  
  return (
    <div className="related-items">
      {relatedItems.entities.length > 0 && (
        <div className="related-entities">
          <h3>Related Entities</h3>
          <ul>
            {relatedItems.entities.map(entity => (
              <li key={entity.id}>
                <button onClick={() => selectEntity(entity.id)}>
                  {entity.name} ({entity.type})
                </button>
              </li>
            ))}
          </ul>
        </div>
      )}
      
      {/* Similar sections for events and locations */}
    </div>
  );
};
```

### Testing

#### Testing Strategy
[Source: architecture/technical-architecture-document.md#testing-strategy]

For this story, focus on:

1. **Component Testing**: Test the Inspector Panel and its subcomponents
2. **Integration Testing**: Test integration with SelectionContext and UIContext
3. **Interaction Testing**: Test user interactions like collapsing/expanding

Test files should be organized in the `tests` directory with appropriate subdirectories for unit and integration tests.

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2023-06-18 | 0.1 | Initial story draft | Scrum Master |

## Dev Agent Record

### Agent Model Used

### Debug Log References

### Completion Notes List

### File List

## QA Results
